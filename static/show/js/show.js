function getTop3Rank(){$.ajax({type:"post",url:"ajax.php?m=getRank",data:{"token":token,"is_img":0},dataType:"json",success:function(d){if(errorCheck(d)){return false}var b=$("<table>");var c=$("<thead>");c.appendTo(b);var a=0;debugLog(d[1]);$.each(d[1],function(f,g){var e=$("<tr>");if(f<3){$('<td class="gold">').text(f+1).appendTo(e);$('<td class="china color_yellow">').text(g[1]).appendTo(e);$('<td class="color_blue">').text(g[0]+" PT").appendTo(e)}else{$("<td>").text(f+1).appendTo(e);$('<td class="china">').text(g[1]).appendTo(e);$("<td>").text(g[0]+" PT").appendTo(e)}e.appendTo(b)});debugLog(b.html());$("#score").html(b.html())},error:function(a){debugLog(a)}});return false}Date.prototype.format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};function getCTFType(){$.ajax({type:"post",url:"ajax.php?m=getCTFType",data:{"token":token},dataType:"json",success:function(a){debugLog(a);if(errorCheck(a)){return false}a=a[1];if(a[0]=="1"){$(".time").hide();$("#headline").hide()}else{startTime=a[1];endTime=a[2];nowTime=(new Date().getTime()+"").substring(0,10);if(nowTime<startTime){$(".time").hide();$("#headline").html("比赛尚未开始");$(".time").downCount({date:new Date(startTime*1000).format("M/d/yyyy hh:mm:ss"),offset:+8},function(){debugLog("比赛已经开始")})}else{if(nowTime>=startTime&&nowTime<=endTime){console.log("now -> "+new Date().format("M/d/yyyy hh:mm:ss"));console.log("end -> "+new Date(endTime*1000).format("M/d/yyyy hh:mm:ss"));$(".time").downCount({date:new Date(endTime*1000).format("M/d/yyyy hh:mm:ss"),offset:+8},function(){debugLog("比赛已经结束")});$(".time").show();$("#headline").html("比赛正进行中")}else{$(".time").hide();$("#headline").html("比赛已经结束")}}}},error:function(a){debugLog(a)}});return false}function getRecentSloves(){$.ajax({type:"post",url:"ajax.php?m=getRecentSloves",data:"token="+token,dataType:"json",success:function(b){console.log(b);if(errorCheck(b)){return false}var a=$("<li>");$.each(b[1],function(d,e){var c=$('<li><div class="contxt ">');$('<span class="data">').html(getMyDate(e[0])).appendTo(c);$('<span class="team1 color_yellow">').html(e[1]).appendTo(c);$('<mo class="handle color_red">').html("成功攻陷 ").appendTo(c);$('<mo class="handle color_red">').html(quesType[e[3]]).appendTo(c);$('<mo class="handle color_red">').html(" 方向题目").appendTo(c);$('<mo class="team2 color_blue">').html("《"+e[2]+"》").appendTo(c);$("<mo>").html("共耗时 ").appendTo(c);$('<mo class="team2 color_green">').html(e[6]).appendTo(c);$('<span class="fr">').html("PT").appendTo(c);$('<span class="fr color_blue">').html(e[7]).appendTo(c);$('<span class="fr">').html("获得").appendTo(c);c.appendTo(a)});$("#recent_solves").html(a.html())},error:function(a){debugLog(a)}});return false}$(document).ready(function(){getCTFType();getTop3Rank();getRecentSloves();$.fn.downCount=function(d,g){var f=$.extend({date:null,offset:null},d);if(!f.date||!Date.parse(f.date)){$.error("Date not found or Incorrect date format")}var b=this;var a=function(){var h=new Date();var i=h.getTime()+(h.getTimezoneOffset()*60000);var j=new Date(i+(3600000*f.offset));return j};function e(){var t=new Date(f.date),l=a();var k=t-l;if(k<0){clearInterval(c);if(g&&typeof g==="function"){g()}return}var p=1000,r=p*60,h=r*60,v=h*24;var u=Math.floor(k/v),q=Math.floor((k%v)/h),m=Math.floor((k%h)/r),s=Math.floor((k%r)/p);u=(String(u).length>=2)?u:"0"+u;q=(String(q).length>=2)?q:"0"+q;m=(String(m).length>=2)?m:"0"+m;s=(String(s).length>=2)?s:"0"+s;var j=(u===1)?"day":"days",n=(q===1)?"hour":"hours",i=(m===1)?"minute":"minutes",o=(s===1)?"second":"seconds";b.find(".days").text(u+" ");b.find(".hours").text(q+":");b.find(".minutes").text(m+":");b.find(".seconds").text(s);b.find(".days_ref").text(j);b.find(".hours_ref").text(n);b.find(".minutes_ref").text(i);b.find(".seconds_ref").text(o)}var c=setInterval(e,1000)}});function getRankPic(a){var b=[];if(a[0][0]=="0"){return false}$.each(a,function(d,c){if(d>14){return false}b[d]={name:c[1],data:c[4]}});debugLog("info:");debugLog(b);$("#rank_pic").highcharts({credits:{enabled:false},exporting:{enabled:false},colors:["#37a2da","#32c5e9","#67e0e3","#9fe6b8","#ffdb5c","#ff9f7f","#fb7293","#e062ae","#e690d1","#e7bcf3","#9d96f5","#8378ea","#96bfff"],chart:{backgroundColor:"rgba(0,0,0,0)",},title:{text:null},legend:{enabled:false,},xAxis:{type:"datetime",title:{text:null},labels:{style:{color:"#fff",}},},yAxis:{title:{text:null},labels:{style:{color:"#fff",}},min:0},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x:%b-%e}: {point.y:f}"},plotOptions:{spline:{marker:{enabled:true}}},series:b});return false}function getRanks(){$.ajax({type:"post",url:"ajax.php?m=getRank",dataType:"json",data:{"token":token,"is_img":1},success:function(a){debugLog(a);
if(errorCheck(a)){return false}if(a[1].length==0){return false}getRankPic(a[1])},error:function(a){debugLog(a)}});return false}function countSecond(){getRanks();setTimeout("countSecond ()",10000)}function countSeconds(){getCTFType();getTop3Rank();getRecentSloves();setTimeout("countSeconds ()",1000)}$(document).ready(function(){countSecond();countSeconds()});